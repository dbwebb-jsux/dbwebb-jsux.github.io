---
title: En varukorg med CSS och JavaScript
description: Vi skapar en varukorg d칛r vi kan l칛gga till v친ra skivor.
---

## F칬rkunskaper

Du b칬r ha jobbat igenom kmom02, l칛mnat in och skapat en ny branch `kmom03`. Du kan med f칬rdel g칬ra nedanst친ende direkt i ditt webshop-repo.



## Knappar f칬r att l칛gga till i varukorgen

Jag kommer i exemplet utg친 fr친n den produktlistningen som jag har i `index.html` och JavaScript koden i `main.js` som skriver ut den produktlistningen. I `main.js`-filen anv칛nder jag `map`-f칬r att iterera 칬ver produkterna som jag har h칛mtat fr친n API:t. H칛r l칛gger jag till ett `span` element med klassen `add-to-cart` och den specifika produktens id som id f칬r att l칛gga till varor i varukorgen.

```javascript
// main.js
products.map((product) => {
    return `<div class="product">
    <img src="${product.image_url}" alt="Album art ${product.name}" />
    <div class="bottom">
        <p>${product.name}</p>
        <span class="add-to-cart" id="${product.id}">+</span>
    </div>    
</div>`
  }).join("\n")
```

Jag skapar sedan filen `cart.css` som jag l칛gger till i `head`-elementet. H칛r l칛gger jag till CSS f칬r att f친 en rund cirkel runt + tecknet som finns i `span`-elementet. Vi anv칛nder samma h칬jd och bredd, samt border-radius 50% f칬r att skapa en rund cirkel, sedan anv칛nder vi flexbox f칬r att centrera inneh친llet.

```css
/* cart.css */
.add-to-cart {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--text-color);
    color: var(--background-color);
    border-radius: 50%;
    font-size: 2rem;
    width: 3ch;
    height: 3ch;
    cursor: pointer;
}
```

Vi skapar nu `cart.js` som kommer inneh친lla JavaScript-koden f칬r v친r varukorg och l칛gger till den som de andra JavaScript-filerna i `head`-delen. Vi vill nu koppla en `eventListener` till de knapparna som vi precis skapade i `main.js`. Vi g칬r det genom funktionen `instantiateCartButtons` som vi sedan exporterar fr친n filen.

```javascript
// cart.js
function instantiateCartButtons() {
  document.querySelectorAll(".add-to-cart").forEach(
    (elem) => elem.addEventListener("click", addToCart)
  )
}

function addToCart(event) {
  console.log(event.target.id)
}

export { instantiateCartButtons }
```

Vi kan sedan i `main.js` importera och anropa funktionen efter att vi h칛mtat produkterna och lagt till produkterna och l칛gg-till-i-varukorgs-knappen i DOM-tr칛det.

```javascript
// main.js
import { instantiateCartButtons } from "./cart.js"
 
// Andra funktioner och kod

productList.innerHTML = products.map((product) => {
    return `<div class="product">
    <img src="${product.image_url}" alt="Album art ${product.name}" />
    <div class="bottom">
        <p>${product.name}</p>
        <span class="add-to-cart" id="${product.id}">+</span>
    </div>    
</div>`
}).join("\n")

instantiateCartButtons()
```



### Sj칛lva varukorgshanteringen

Vi kan nu b칬rja med att l칛gga till saker i varukorgen i funktionen `addToCart`, som anropas fr친n `instantiateCartButtons`. Vi kommer som i kmom02 anv칛nda oss av LocalStorage f칬r att hantera varukorgen. Vi kan bara spara ner str칛ngar till LocalStorage, men vi anv칛nder os av `JSON.parse`  och `JSON.stringify` ([Dokumentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON)) f칬r att g칬ra om objekt till str칛ngar och omv칛nt.

Vi h칛mtar eller skapar f칬rst varukorgen utifr친n LocalStorage eller ett tomt objekt. Sedan kollar vi om produkten redan finns i varukorgen och l칛gger d친 till ytterligare annars l칛gger vi till produkten i varukorgen. Vi avslutar med med att g칬ra objektet till en str칛ng igen och sedan 

```javascript
// cart.js
function addToCart(event) {
  const productID = event.target.id
  let cart = JSON.parse(localStorage.getItem("cart") || "{}")

  if (cart[productID]) {
    cart[productID] = cart[productID] + 1
  } else {
    cart[productID] = 1
  }

  localStorage.setItem("cart", JSON.stringify(cart))
}
```


### Visa varukorgen

H칬gst upp i `index.html` l칛gger jag i det elementet som jag vill ska inneh친lla min varukorg `.cart-content`. Jag l칛gger 칛ven till objektet `<div class="cart" id="cart">游</div>` som kan anv칛ndas f칬r att 칬ppna och st칛nga varukorgen.

```html
<!-- index.html -->
<body class="site">
    <div class="cart-content" id="cart-content">
        <div class="cart-header">
            <h3>Ink칬psvagn</h3>
            <p class="close-cart" id="close-cart">x</p>
        </div>

        <div class="cart-products" id="cart-products"></div>
    </div>
    <header class="header">
        <div class="inner-header">
            <h1><a href="index.html">Emil's skivor</a></h1>

            <div class="right">
                <a href="category.html">Kategori-sidan</a>

                <div class="cart" id="cart">游</div>

                <select id="mode" class="mode">
                    <option value="variables.css">Light</option>
                    <option value="variables-dark.css">Dark</option>
                </select>
            </div>            
        </div>        
    </header>

<!-- resten av koden -->
```

I filen `cart.css` l칛gger jag till f칬ljande CSS f칬r att designa varukorgen. Jag anv칛nder `position: absolute;` f칬r att l칛gga varukorgen utanf칬r det normala fl칬det s친 det ser ut som den 칛r ovanf칬r resten av sidan. Just nu kan du inte se varukorgen men om du kommentarer ut `display: none;` b칬r den visas som att den tar upp knappt h칛lften av sk칛rmen.

```css
/* cart.css */
.cart {
    font-size: 2rem;
    cursor: pointer;
}

.cart-content {
    display: none;
    position: absolute;
    top: 1vh;
    right: 0;
    height: 98vh;
    width: 40vw;
    background-color: var(--background-color);
    border-top-left-radius: 1.75rem;
    border-bottom-left-radius: 1.75rem;
    padding: 1.75rem;
    z-index: 1;
    box-shadow: -4px 4px 20px 0 rgba(0 0 0 / 75%);
    overflow-y: scroll;
}
```

Vi l칛gger 칛ven till selektorn `.cart-content.active` i `cart.css`. N칛r vi har tv친 klasser utan mellanrum i v친ra CSS-filer inneb칛r det element som har b친da klasserna.

```css
/* cart.css */
.cart-content.active {
    display: block;
}
```

Vi kan nu b칬rja titta p친 logiken f칬r att 칬ppna och st칛nga varukorgen. Vi forts칛tter med denna kod i `cart.js`. F칬rst ser vi till att h칛mta ut de element som vi vill p친verka och skapar sedan en `eventListener` f칬r `cart`.

```javascript
// cart.js
const cartContent = document.getElementById("cart-content")
const cart = document.getElementById("cart")
cart.addEventListener("click", toggleCart)
```

I funktion `toggleCart` s칛tter vi f칬rst `style.top` attributet till hur l친ngt vi har scrollat ner p친 sidan plus 1% av h칬jden av webbl칛sar f칬nstret. 1% av h칬jden motsvarar `1vh` som vi satte i CSS filen. Sedan togglar vi klassen `active` p친 varukorgselementet. N칛r vi anv칛nder funktionen `toggle` l칛ggs klassen till om den inte redan finns p친 elementet. Om klassen redan finns tas den bort.

Vi kollar sedan om klassen finns d칛r och kapar d친 bort all `overflow` (det som finns utanf칬r webbl칛sarf칬nstret) vilket g칬ra att vi inte kan scrolla p친 sidan n칛r varukorgen 칛r 칬ppen. Vi anropar 칛ven funktionen `renderCartProducts()` som renderar produkterna.

```javascript
// cart.js
function toggleCart() {
  cartContent.style.top = `${(window.scrollY + document.documentElement.clientHeight / 100)}px`
  cartContent.classList.toggle("active")

  if (cartContent.classList.contains("active")) {
    document.body.style.overflow = "hidden"
    renderCartProducts()
  } else {
    document.body.style.overflow = "auto"
  }
}
```

I `renderCartProducts()` h칛mtar vi ut v친r varukorgsobjekt fr친n LocalStorage och renderar ut varje produkt med det antal som ligger i varukorgen. Hela koden f칬r `cart.js` ser allts친 ut p친 detta s칛ttet. Filen `models/products.js` kan ni skapa sj칛lv f칬r att strukturera koden p친 ett bra s칛tt.

```javascript
// cart.js
import products from "../models/products.js"

const cartContent = document.getElementById("cart-content")
const cart = document.getElementById("cart")
cart.addEventListener("click", toggleCart)

const closeCart = document.getElementById("close-cart")
closeCart.addEventListener("click", toggleCart)

function toggleCart() {
  cartContent.style.top = `${(window.scrollY + document.documentElement.clientHeight / 100)}px`
  cartContent.classList.toggle("active")

  if (cartContent.classList.contains("active")) {
    document.body.style.overflow = "hidden"
    renderCartProducts()
  } else {
    document.body.style.overflow = "auto"
  }
}

function instantiateCartButtons() {
  document.querySelectorAll(".add-to-cart").forEach(
    (elem) => elem.addEventListener("click", addToCart)
  )
}

function addToCart(event) {
  const productID = event.target.id
  let cart = JSON.parse(localStorage.getItem("cart") || "{}")

  if (cart[productID]) {
    cart[productID] = cart[productID] + 1
  } else {
    cart[productID] = 1
  }

  localStorage.setItem("cart", JSON.stringify(cart))

  toggleCart()
}

async function renderCartProducts() {
  let cartHTML = "<p>No products in cart.</p>"
  if (localStorage.getItem("cart")) {
    const cart = JSON.parse(localStorage.getItem("cart"))
    const cartItems = []

    for (let product in cart) {
      const productInfo = await products.fetchProduct(product)
      const cartItem = `<div class="cart-item">
    <img src="${productInfo.data.image_url}" alt="Album art ${productInfo.data.name}" />
    <p>${productInfo.data.name}</p><p>Antal: ${cart[product]}</p>
</div>`

      cartItems.push(cartItem)
    }

    cartHTML = cartItems.join("\n")
  }

  document.getElementById("cart-products").innerHTML = cartHTML
}

export { instantiateCartButtons }
```